openapi: 3.0.3
info:
  title: CRM-mail OpenAPI definition
  version: "1.0.0"
servers:
  - url: 'http://localhost:9010'
    description: Generated server url
paths:
  /api/v1/admin/login:
    post:
      tags:
        - admin
      summary: проверка логина админского
      security:
        - basic: []
      responses:
        '200':
          description: OK
  /api/v1/admin/users:
    get:
      tags:
        - admin
      summary: список юзеров
      operationId: getUsers
      security:
        - basic: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: "array"
                items:
                  $ref: '#/components/schemas/User'
    post:
      tags:
        - admin
      summary: "добавить юзера"
      operationId: "postUser"
      security:
        - basic: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
        required: true
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/User"
    put:
      tags:
        - admin
      summary: изменить существующего юзера
      operationId: putUser
      security:
        - basic: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
        required: true
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/User"
  /api/v1/application/roles:
    get:
      tags:
        - application
      summary: "GET api/v1/application/roles"
      operationId: "getRoles"
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                type: "array"
                items:
                  $ref: "#/components/schemas/Role"
  /api/v1/application/login:
    post:
      tags:
        - application
      operationId: login
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequestDto'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: '#/components/schemas/LoginResponseDto'
  /api/v1/application/configuration:
    get:
      tags:
        - application
      operationId: getConfiguration
      responses:
        '200':
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: '#/components/schemas/ConfigurationDto'
  /api/v1/leads:
    get:
      tags:
        - leads
      summary: "Все лиды, со всеми событиями доступные текущему юзеру"
      operationId: "getLeads"
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                type: "array"
                items:
                  $ref: "#/components/schemas/Lead"
    post:
      tags:
        - leads
      summary: "создает новый лид"
      description: "Lead  можно не передавать, в этом случае значения будут дефолтными"
      operationId: "postLead"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Lead"
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/Lead"
    put:
      tags:
        - leads
      summary: "изменяет существующий лид"
      description: "обновит только переданные поля, id передавать обязательно"
      operationId: "putLead"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Lead"
        required: true
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/Lead"
  /api/v1/leads/{id}:
    get:
      tags:
        - leads
      summary: "возвращает лид, со всеми событиями доступные текущему юзеру"
      operationId: "getLead"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "integer"
            format: "int64"
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/Lead"
  /api/v1/leads/{id}/addEmail:
    put:
      tags:
        - leads
      summary: "Добавляет email к существующему лиду"
      operationId: "addMessage"
      parameters:
        - name: "id"
          in: "path"
          required: true
          schema:
            type: "integer"
            format: "int64"
        - name: "folderId"
          in: "query"
          required: true
          schema:
            type: "string"
        - name: "messageUid"
          in: "query"
          required: true
          schema:
            type: "integer"
            format: "int64"
        - name: "roleIds"
          in: "query"
          required: false
          schema:
            type: "array"
            items:
              type: integer
          explode: false
      responses:
        "200":
          description: "OK"
  /api/v1/leads/newWithEmail:
    post:
      tags:
        - leads
      summary: "Добавляет email к новому лиду"
      operationId: "newLeadWithMessage"
      parameters:
        - name: "folderId"
          in: "query"
          required: true
          schema:
            type: "string"
        - name: "messageUid"
          in: "query"
          required: true
          schema:
            type: "integer"
            format: "int64"
        - name: "roleIds"
          in: "query"
          required: false
          schema:
            type: "array"
            items:
              type: integer
          explode: false
      responses:
        "200":
          description: "OK"

  /api/v1/folders:
    get:
      summary: Loading list of folders
      tags:
        - folders
      operationId: getFolders
      parameters:
        - name: loadChildren
          in: query
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: OK
          content:
            application/hal+json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Folder'
    post:
      summary: createRootFolder
      description: 'Creating new 1st level folder with name {}'
      tags:
        - folders
      operationId: createRootFolder
      requestBody:
        content:
          application/json:
            schema:
              type: string
        required: true
      responses:
        '200':
          description: OK
          content:
            application/hal+json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Folder'
  '/api/v1/folders/{folderId}':
    post:
      summary: createChildFolder
      description: 'Creating new folder with name {} under {} folder", newFolderName, folderId'
      tags:
        - folders
      operationId: createChildFolder
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: string
        required: true
      responses:
        '200':
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: '#/components/schemas/Folder'
    delete:
      summary: deleteFolder
      description: 'Deleting folder with id {}", folderId'
      tags:
        - folders
      operationId: deleteFolder
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: '#/components/schemas/Folder'
  '/api/v1/folders/{folderId}/parent':
    put:
      summary: moveFolder
      description: moveFolder
      tags:
        - folders
      operationId: moveFolder
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: string
      responses:
        '200':
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: '#/components/schemas/Folder'
  '/api/v1/folders/{folderId}/name':
    put:
      summary: renameFolder
      description: 'Renaming folder with id {folderId} to {newName}'
      tags:
        - folders
      operationId: renameFolder
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        description: new name
        content:
          application/json:
            schema:
              type: string
        required: true
      responses:
        '200':
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: '#/components/schemas/Folder'
  '/api/v1/folders/{folderId}/messages':
    get:
      summary: 'Loading list of messages for folder {}'
      description: 'тут что то непонятное, два метода, что то асинхронное'
      tags:
        - '/{folderId}/messages'
      operationId: preloadMessages_1
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: query
          required: true
          schema:
            type: array
            items:
              type: integer
              format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Message'
            text/event-stream:
              schema:
                $ref: '#/components/schemas/FluxServerSentEventListMessage'
    delete:
      summary: deleteAllFolderMessages or selected
      description: 'Deleting ALL messages for folder {} if id not presents'
      tags:
        - '/{folderId}/messages'
      operationId: deleteAllFolderMessages_1
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: query
          required: false
          schema:
            type: array
            items:
              type: integer
              format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
  '/api/v1/folders/{folderId}/messages/folder/{toFolderId}':
    put:
      summary: moveMessages
      description: 'Moving {List<Long> messageIds} messages from folder {} to folder {}'
      tags:
        - '/{folderId}/messages'
      operationId: moveMessages
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
        - name: toFolderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: integer
                format: int64
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MessageWithFolder'
  '/api/v1/folders/{folderId}/messages/seen/{seen}':
    put:
      summary: setMessagesSeen
      tags:
        - '/{folderId}/messages'
      operationId: setMessagesSeen
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
        - name: seen
          in: path
          required: true
          schema:
            type: boolean
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: integer
                format: int64
        required: true
      responses:
        '200':
          description: OK
  '/api/v1/folders/{folderId}/messages/{messageId}':
    get:
      summary: getMessage
      tags:
        - '/{folderId}/messages/{messageId}/'
      operationId: getMessage_1
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/MessageWithFolder'
  '/api/v1/folders/{folderId}/messages/{messageId}/folder/{toFolderId}':
    put:
      summary: moveMessage
      tags:
        - '/{folderId}/messages/{messageId}/'
      operationId: moveMessage
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: toFolderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MessageWithFolder'
  '/api/v1/folders/{folderId}/messages/{messageId}/seen':
    put:
      summary: setMessageSeen
      tags:
        - '/{folderId}/messages/{messageId}/'
      operationId: setMessageSeen
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        content:
          application/json:
            schema:
              type: boolean
        required: true
      responses:
        '200':
          description: OK
  '/api/v1/folders/{folderId}/messages/{messageId}/flagged':
    put:
      summary: setMessageFlagged
      tags:
        - '/{folderId}/messages/{messageId}/'
      operationId: setMessageFlagged
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        content:
          application/json:
            schema:
              type: boolean
        required: true
      responses:
        '200':
          description: OK
  '/api/v1/folders/{folderId}/messages/{messageId}/attachments/{id}':
    get:
      summary: getAttachment
      tags:
        - '/{folderId}/messages/{messageId}/'
      operationId: getAttachment
      parameters:
        - name: folderId
          in: path
          required: true
          schema:
            type: string
        - name: messageId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: contentId
          in: query
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: OK
  /api/v1/smtp:
    post:
      summary: sendMessage
      tags:
        - smtp-resource
      operationId: sendMessage
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Message'
        required: true
      responses:
        '200':
          description: OK
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: Isotope-Credentials
      description: токен автроризации
    basic:
      type: http
      scheme: basic
      description: 'имя admin, пароль передается в переменной окружения в сервер'
  schemas:
    Folder:
      type: object
      properties:
        folderId:
          type: string
        previousFolderId:
          type: string
          description: используется только переименовании папки
        name:
          type: string
        separator:
          type: string
        fullName:
          type: string
        fullURL:
          type: string
        attributes:
          uniqueItems: true
          type: array
          items:
            type: string
        messageCount:
          type: integer
          format: int32
        newMessageCount:
          type: integer
          format: int32
        unreadMessageCount:
          type: integer
          format: int32
        deletedMessageCount:
          type: integer
          format: int32
        children:
          type: array
          items:
            $ref: '#/components/schemas/Folder'
        uidvalidity:
          type: integer
          format: int64
        _links:
          type: array
          items:
            $ref: '#/components/schemas/Link'
    Link:
      type: object
      properties:
        rel:
          type: string
        href:
          type: string
        hreflang:
          type: string
        media:
          type: string
        title:
          type: string
        type:
          type: string
        deprecation:
          type: string
        profile:
          type: string
        name:
          type: string
      title: ''
    Attachment:
      type: object
      properties:
        contentId:
          type: string
        fileName:
          type: string
        contentType:
          type: string
        size:
          type: integer
          format: int32
        content:
          type: array
          items:
            type: string
            format: byte
        _links:
          type: array
          items:
            $ref: '#/components/schemas/Link'
    MessageWithFolder:
      required:
        - recipients
      type: object
      properties:
        uid:
          type: integer
          format: int64
        messageId:
          type: string
        modseq:
          type: integer
          format: int64
        from:
          type: array
          items:
            type: string
        replyTo:
          type: array
          items:
            type: string
        recipients:
          type: array
          items:
            $ref: '#/components/schemas/Recipient'
        subject:
          type: string
        receivedDate:
          type: string
          format: date-time
        size:
          type: integer
          format: int64
        flagged:
          type: boolean
        seen:
          type: boolean
        recent:
          type: boolean
        deleted:
          type: boolean
        content:
          type: string
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/Attachment'
        references:
          type: array
          items:
            type: string
        inReplyTo:
          type: array
          items:
            type: string
        listUnsubscribe:
          type: array
          items:
            type: string
        folder:
          $ref: '#/components/schemas/Folder'
        _links:
          type: array
          items:
            $ref: '#/components/schemas/Link'
    Recipient:
      type: object
      properties:
        type:
          type: string
        address:
          type: string
    Message:
      type: object
      properties:
        uid:
          type: integer
          format: int64
        messageId:
          type: string
        modseq:
          type: integer
          format: int64
        from:
          type: array
          items:
            type: string
        replyTo:
          type: array
          items:
            type: string
        recipients:
          type: array
          items:
            $ref: '#/components/schemas/Recipient'
        subject:
          type: string
        receivedDate:
          type: string
          format: date-time
        size:
          type: integer
          format: int64
        flagged:
          type: boolean
        seen:
          type: boolean
        recent:
          type: boolean
        deleted:
          type: boolean
        content:
          type: string
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/Attachment'
        references:
          type: array
          items:
            type: string
        inReplyTo:
          type: array
          items:
            type: string
        listUnsubscribe:
          type: array
          items:
            type: string
        _links:
          type: array
          items:
            $ref: '#/components/schemas/Link'
    LoginResponseDto:
      required:
        - encrypted
        - salt
      properties:
        encrypted:
          type: string
        salt:
          type: string
          default: none
          description: 'не используется сервером, в будущем будет удалено'
          deprecated: true
    LoginRequestDto:
      type: object
      properties:
        user:
          type: string
        password:
          type: string
      required:
        - user
        - password
    FluxServerSentEventListMessage:
      type: object
      properties:
        prefetch:
          type: integer
          format: int32
    ConfigurationDto:
      type: object
      properties:
        _links:
          type: array
          items:
            $ref: '#/components/schemas/Link'
    Role:
      type: "object"
      properties:
        id:
          type: "integer"
          format: "int64"
        role:
          type: "string"
    User:
      type: "object"
      properties:
        id:
          type: "integer"
          format: "int64"
        serverHost:
          type: "string"
        serverPort:
          type: "integer"
          format: "int32"
        userName:
          type: "string"
        imapSsl:
          type: "boolean"
        smtpHost:
          type: "string"
        smtpPort:
          type: "integer"
          format: "int32"
        smtpSsl:
          type: "boolean"
        enabled:
          type: "boolean"
        roles:
          type: "array"
          items:
            $ref: "#/components/schemas/Role"
    LeadStatus:
      type: "object"
      properties:
        id:
          type: "integer"
          format: "int64"
        order:
          type: "integer"
          format: "int64"
        name:
          type: "string"
    LeadEvent:
      type: "object"
      properties:
        id:
          type: "integer"
          format: "int64"
        owner:
          $ref: "#/components/schemas/User"
        allowed:
          type: "array"
          items:
            $ref: "#/components/schemas/Role"
        createdDate:
          type: "string"
          format: "date-time"
        lead:
          $ref: "#/components/schemas/Lead"
    Lead:
      type: "object"
      properties:
        id:
          type: "integer"
          format: "int64"
        name:
          type: "string"
        owner:
          $ref: "#/components/schemas/User"
        creationDateTime:
          type: "string"
          format: "date-time"
        status:
          $ref: "#/components/schemas/LeadStatus"
        summary:
          type: "string"
        allowed:
          type: "array"
          items:
            $ref: "#/components/schemas/Role"
        leadEvents:
          type: "array"
          items:
            $ref: "#/components/schemas/LeadEvent"